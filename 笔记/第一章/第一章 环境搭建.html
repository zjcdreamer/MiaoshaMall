<html>
<head>
  <title>Evernote Export</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/601967 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 14pt;
    }
  </style>
</head>
<body>
<a name="2372"/>

<div>
<span><div><div><font style="font-size: 24pt;"><span style="font-size: 24pt; font-weight: bold;">一、Mybatis环境搭建</span></font></div><hr/><div><br/></div><div>1）导入JDBC、MySQL、MyBatis、Druid的依赖</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>&lt;dependency&gt;</div><div>    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div>    &lt;artifactId&gt;spring-boot-starter-<b>jdbc</b>&lt;/artifactId&gt;</div><div>&lt;/dependency&gt;</div><div>&lt;dependency&gt;</div><div>    &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt;</div><div>    &lt;artifactId&gt;<b>mybatis</b>-spring-boot-starter&lt;/artifactId&gt;</div><div>    &lt;version&gt;1.3.2&lt;/version&gt;</div><div>&lt;/dependency&gt;</div><div>&lt;dependency&gt;</div><div>    &lt;groupId&gt;mysql&lt;/groupId&gt;</div><div>    &lt;artifactId&gt;<b>mysql</b>-connector-java&lt;/artifactId&gt;</div><div>    &lt;scope&gt;<b>compile</b>&lt;/scope&gt;</div><div>&lt;/dependency&gt;</div><div>&lt;dependency&gt;</div><div>    &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</div><div>    &lt;artifactId&gt;druid&lt;/artifactId&gt;</div><div>    &lt;version&gt;1.1.4&lt;/version&gt;</div><div>&lt;/dependency&gt;</div></div><div><br/></div><div>2）在application.properties中编写连接数据库的配置</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>spring.datasource.username=root</div><div>spring.datasource.password=root</div><div>spring.datasource.url=jdbc:mysql://localhost:3306/miaosha?serverTimezone=UTC</div><div>spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver</div></div><div><br/></div><div>3）编写实体类User--&gt;与数据库对象对应</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>package com.imooc.miaosha.domain;</div><div><br/></div><div><br/></div><div>public class User {</div><div>    private int id;</div><div>    private String name;</div><div><br/></div><div><br/></div><div>    public User() {</div><div>    }</div><div><br/></div><div><br/></div><div>    public User(int id, String name) {</div><div>        this.id = id;</div><div>        this.name = name;</div><div>    }</div><div><br/></div><div><br/></div><div>    public int getId() {</div><div>        return id;</div><div>    }</div><div><br/></div><div><br/></div><div>    public void setId(int id) {</div><div>        this.id = id;</div><div>    }</div><div><br/></div><div><br/></div><div>    public String getName() {</div><div>        return name;</div><div>    }</div><div><br/></div><div><br/></div><div>    public void setName(String name) {</div><div>        this.name = name;</div><div>    }</div><div>}</div></div><div><br/></div><div>4）编写DAO层，这里直接使用注解形式的sql语句，而不单独再写一个xml文件来实现接口中的方法</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>package com.imooc.miaosha.dao;</div><div><br/></div><div><br/></div><div>import com.imooc.miaosha.domain.User;</div><div>import org.apache.ibatis.annotations.Mapper;</div><div>import org.apache.ibatis.annotations.Param;</div><div>import org.apache.ibatis.annotations.Select;</div><div><br/></div><div><br/></div><div><b>@Mapper</b></div><div>public interface IuserDAO {</div><div><br/></div><div><br/></div><div>    //查找一名用户</div><div>    @Select(&quot;select * from user where id = #{id}&quot;)</div><div>    public User getById(@Param(&quot;id&quot;) int id);</div><div>}</div><div><br/></div><div>@Mapper和@Repository的异同</div><div>同：</div><div>    @Mapper和@Repository是常用的两个注解，两者都是用在dao上</div><div>异：</div><div>    @Repository需要在Spring中配置扫描地址，然后生成Dao层的Bean才能被注入到Service层中：如下，在启动类中配置扫描地址：</div></div><div><br/></div><div>5）编写Service层，注入dao</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>package com.imooc.miaosha.service;</div><div><br/></div><div><br/></div><div>import com.imooc.miaosha.dao.IuserDAO;</div><div>import com.imooc.miaosha.domain.User;</div><div>import org.springframework.beans.factory.annotation.Autowired;</div><div>import org.springframework.stereotype.Service;</div><div><br/></div><div><br/></div><div>@Service</div><div>public class UserService {</div><div><br/></div><div><br/></div><div>    @Autowired</div><div>    IuserDAO iuserDAO;</div><div><br/></div><div><br/></div><div>    public User getById(int id){</div><div>        return iuserDAO.getById(id);</div><div>    }</div><div>}</div></div><div><br/></div><div>6）编写Controller层</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>package com.imooc.miaosha.controller;</div><div><br/></div><div><br/></div><div>import com.imooc.miaosha.domain.User;</div><div>import com.imooc.miaosha.service.UserService;</div><div>import org.springframework.beans.factory.annotation.Autowired;</div><div>import org.springframework.stereotype.Controller;</div><div>import org.springframework.ui.Model;</div><div>import org.springframework.web.bind.annotation.RequestMapping;</div><div>import org.springframework.web.bind.annotation.ResponseBody;</div><div><br/></div><div><br/></div><div>@Controller</div><div>@RequestMapping(&quot;/demo&quot;)</div><div>public class Samplecontroller {</div><div><br/></div><div><br/></div><div>    @Autowired</div><div>    UserService userService;</div><div><br/></div><div><br/></div><div>    @RequestMapping(&quot;/thymeleaf&quot;)</div><div>    public String thymeleaf(Model model){</div><div>        model.addAttribute(&quot;name&quot;, &quot;Jack&quot;);</div><div>        System.out.println(&quot;输出============================&quot;);</div><div>        return &quot;hello&quot;;</div><div>    }</div><div><br/></div><div><br/></div><div>    @ResponseBody</div><div>    @RequestMapping(&quot;/db/get&quot;)</div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">        //这里的Result类是自己编写的</span></div><div>    public Result&lt;User&gt; get(){</div><div>        User user = userService.getById(1);</div><div>        return Result.success(user);</div><div>    }</div><div>}</div></div><div><br/></div><div>7）进行事务的检测，插入两个对象，一个对象有问题使得另一个对象也无法插入到表中</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>package com.imooc.miaosha.service;</div><div><br/></div><div><br/></div><div>import com.imooc.miaosha.dao.IuserDAO;</div><div>import com.imooc.miaosha.domain.User;</div><div>import org.springframework.beans.factory.annotation.Autowired;</div><div>import org.springframework.stereotype.Service;</div><div>import org.springframework.transaction.annotation.Transactional;</div><div><br/></div><div><br/></div><div><b><font style="font-size: 11pt;">@Service</font></b></div><div>public class UserService {</div><div><br/></div><div><br/></div><div>    @Autowired</div><div>    IuserDAO iuserDAO;</div><div><br/></div><div><br/></div><div>    public User getById(int id){</div><div>        return iuserDAO.getById(id);</div><div>    }</div><div><br/></div><div><br/></div><div>  <b><font style="font-size: 11pt;">  @Transactional</font></b></div><div>    public boolean tx(){</div><div>        User u1 = new User(1,&quot;hhh&quot;);</div><div>        User u2 = new User(2, &quot;tx&quot;);</div><div>        iuserDAO.insert(u2);</div><div>        iuserDAO.insert(u1);</div><div>        return true;</div><div>    }</div><div>}</div><div><br/></div><div><b><font style="font-size: 10pt;">DAO层的对应接口方法</font></b></div><div>@Insert(&quot;insert into user values(#{id}, #{name})&quot;)</div><div>public int insert(User user);</div><div><br/></div><div><b><font style="font-size: 10pt;">Controller层对应的方法</font></b></div><div>//这部分是检测事务，注意看Service层的@Transtractioanl</div><div>@ResponseBody</div><div>@RequestMapping(&quot;/db/tx&quot;)</div><div>public Result&lt;Boolean&gt; tx(){</div><div>    userService.tx();</div><div>    return Result.success(true);</div><div>}</div></div><div><br/></div><div><font style="font-size: 24pt;"><br/></font></div><div><span style="font-size: 24pt; font-weight: bold;">二、Redis的安装和集成</span></div><hr/><div>Redis安装在服务器上</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>#ps -ef | grep xx    查看xx的进程</div><div><br/></div><div>#ll 显示当前文件夹中的文件</div><div><br/></div><div>#pwd   显示当前所在的路径</div><div><br/></div><div>#cd xx  进入某个文件夹</div><div><br/></div><div>#cd .. 回退一级</div><div><br/></div><div>linux的删除方式可以是ctrl+U</div></div><div><br/></div><div>Redis的集成</div><div>1）导入Jedis和FastJson的依赖</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>&lt;dependency&gt;</div><div>    &lt;groupId&gt;redis.clients&lt;/groupId&gt;</div><div>    &lt;artifactId&gt;jedis&lt;/artifactId&gt;</div><div>    &lt;version&gt;3.3.0&lt;/version&gt;</div><div>&lt;/dependency&gt;</div><div><br/></div><div>&lt;dependency&gt;</div><div>    &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</div><div>    &lt;artifactId&gt;fastjson&lt;/artifactId&gt;</div><div>    &lt;version&gt;1.2.68&lt;/version&gt;</div><div>&lt;/dependency&gt;</div></div><div><br/></div><div>2）在application.properties中编写配置</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>#thymeleaf</div><div>spring.thymeleaf.prefix=classpath:/templates/</div><div>spring.thymeleaf.suffix=.html</div><div>spring.thymeleaf.cache=false</div><div>spring.thymeleaf.content-type=text/html</div><div>spring.thymeleaf.enabled=true</div><div>spring.thymeleaf.encoding=UTF-8</div><div>spring.thymeleaf.mode=HTML5</div><div># mybatis</div><div>mybatis.type-aliases-package=com.imooc.miaosha.domain</div><div>mybatis.configuration.map-underscore-to-camel-case=true</div><div>mybatis.configuration.default-fetch-size=100</div><div>mybatis.configuration.default-statement-timeout=3000</div><div>mybatis.mapperLocations = classpath:com/imooc/miaosha/dao/*.xml</div><div># druid</div><div>spring.datasource.url=jdbc:mysql://localhost:3306/miaosha?serverTimezone=UTC</div><div>spring.datasource.username=root</div><div>spring.datasource.password=root</div><div>spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver</div><div>spring.datasource.type=com.alibaba.druid.pool.DruidDataSource</div><div>spring.datasource.filters=stat</div><div>spring.datasource.maxActive=2</div><div>spring.datasource.initialSize=1</div><div>spring.datasource.maxWait=60000</div><div>spring.datasource.minIdle=1</div><div>spring.datasource.timeBetweenEvictionRunsMillis=60000</div><div>spring.datasource.minEvictableIdleTimeMillis=300000</div><div>spring.datasource.validationQuery=select 'x'</div><div>spring.datasource.testWhileIdle=true</div><div>spring.datasource.testOnBorrow=false</div><div>spring.datasource.testOnReturn=false</div><div>spring.datasource.poolPreparedStatements=true</div><div>spring.datasource.maxOpenPreparedStatements=20</div><div>#redis</div><div>redis.host=112.126.58.1</div><div>redis.port=6379</div><div>redis.timeout=3</div><div>redis.password=123456</div><div>redis.poolMaxTotal=10</div><div>redis.poolMaxIdle=10</div><div>redis.poolMaxWait=3</div></div><div><br/></div><div>如果出现这种情况，就在pom文件中添加下面的依赖：<img src="第一章 环境搭建_files/Image.png" type="image/png" data-filename="Image.png"/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>&lt;dependency&gt;</div><div>     &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div>     &lt;artifactId&gt;spring-boot-configuration-processor&lt;/artifactId&gt;</div><div>     &lt;optional&gt;true&lt;/optional&gt;</div><div>&lt;/dependency&gt;</div></div><div><br/></div><div>3）编写配置类</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>package com.imooc.miaosha.redis;</div><div><br/></div><div><br/></div><div>import org.springframework.boot.context.properties.ConfigurationProperties;</div><div>import org.springframework.stereotype.Component;</div><div><br/></div><div><br/></div><div>@Component</div><div>@ConfigurationProperties(prefix = &quot;redis&quot;)</div><div>public class RedisConfig {</div><div>    private String host;</div><div>    private int port;</div><div>    private int timeout;//秒</div><div>    private String password;</div><div>    private int poolMaxTotal;</div><div>    private int poolMaxIdle;</div><div>    private int poolMaxWait;//秒</div><div>    public String getHost() {</div><div>        return host;</div><div>    }</div><div>    public void setHost(String host) {</div><div>        this.host = host;</div><div>    }</div><div>    public int getPort() {</div><div>        return port;</div><div>    }</div><div>    public void setPort(int port) {</div><div>        this.port = port;</div><div>    }</div><div>    public int getTimeout() {</div><div>        return timeout;</div><div>    }</div><div>    public void setTimeout(int timeout) {</div><div>        this.timeout = timeout;</div><div>    }</div><div>    public String getPassword() {</div><div>        return password;</div><div>    }</div><div>    public void setPassword(String password) {</div><div>        this.password = password;</div><div>    }</div><div>    public int getPoolMaxTotal() {</div><div>        return poolMaxTotal;</div><div>    }</div><div>    public void setPoolMaxTotal(int poolMaxTotal) {</div><div>        this.poolMaxTotal = poolMaxTotal;</div><div>    }</div><div>    public int getPoolMaxIdle() {</div><div>        return poolMaxIdle;</div><div>    }</div><div>    public void setPoolMaxIdle(int poolMaxIdle) {</div><div>        this.poolMaxIdle = poolMaxIdle;</div><div>    }</div><div>    public int getPoolMaxWait() {</div><div>        return poolMaxWait;</div><div>    }</div><div>    public void setPoolMaxWait(int poolMaxWait) {</div><div>        this.poolMaxWait = poolMaxWait;</div><div>    }</div><div>}</div></div><div><br/></div><div>4）编写Service层（进行了一次改造，第一次编写的时候就将key作为key，不加前缀，但是这样可能会导致重复的key进行内容的覆盖，所以改造成前缀+key作为key，这样就很大程度上避免了key重复的情况。此外该类中还包括String转json，json转String的操作）</div><div>(<b>这里还涉及的一个知识点就是前缀的设计。先设计了一个接口，设置了规则。然后用抽象类来实现该接口，并完成公共内容的设计。最后再由具体的实现类来继承该抽象类，具体化内容。</b>）</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>package com.imooc.miaosha.redis;</div><div><br/></div><div><br/></div><div>import com.alibaba.fastjson.JSON;</div><div>import org.springframework.beans.factory.annotation.Autowired;</div><div>import org.springframework.stereotype.Service;</div><div>import redis.clients.jedis.Jedis;</div><div>import redis.clients.jedis.JedisPool;</div><div><br/></div><div><br/></div><div>@Service</div><div>public class RedisService {</div><div><br/></div><div><br/></div><div>    @Autowired</div><div>    JedisPool jedisPool;</div><div><br/></div><div><br/></div><div>    /**</div><div>     * 根据K和V的类型，获取V的值</div><div>     * @param prefix</div><div>     * @param key</div><div>     * @param clazz</div><div>     * @param &lt;T&gt;</div><div>     * @return</div><div>     */</div><div>    public &lt;T&gt; T get(<b>KeyPrefix prefix</b>, String key, Class&lt;T&gt; clazz){</div><div>        Jedis jedis = null;</div><div>        try {</div><div>            jedis = jedisPool.getResource();</div><div>            <b>//得到真正的key</b><b><br/></b></div><div><b>            String realKey = prefix.getPrefix()+key;</b></div><div>            String str = jedis.get(realKey);</div><div>            T t = stringToBean(str, clazz);</div><div>            return t;</div><div>        }finally {</div><div>            returnToPool(jedis);</div><div>        }</div><div>    }</div><div><br/></div><div><br/></div><div>    /**</div><div>     * 向Redis中添加一个K-V对</div><div>     * @param prefix</div><div>     * @param key</div><div>     * @param val</div><div>     * @param &lt;T&gt;</div><div>     * @return</div><div>     */</div><div>    public &lt;T&gt; boolean set(KeyPrefix prefix, String key, T val){</div><div>        Jedis jedis = null;</div><div>        try {</div><div>            jedis = jedisPool.getResource();</div><div>            String str = beanToString(val);</div><div>            if(str == null || str.length() &lt;= 0) return false;</div><div>           <b> </b><b>//得到真正的key</b></div><div>            String realKey = prefix.getPrefix()+key;</div><div>            int second = prefix.empireSecond();</div><div>            if(second &lt;=0){</div><div>                jedis.set(realKey, str);</div><div>            }else {</div><div>                jedis.setex(realKey,second,str); //设置一定时间后该K-V对过期</div><div>            }</div><div>            return true;</div><div>        }finally {</div><div>            returnToPool(jedis);</div><div>        }</div><div>    }</div><div><br/></div><div><br/></div><div>    /**</div><div>     * 检测提供的K是否存在</div><div>     * @param prefix</div><div>     * @param key</div><div>     * @param &lt;T&gt;</div><div>     * @return</div><div>     */</div><div>    public &lt;T&gt; boolean exists(KeyPrefix prefix, String key){</div><div>        Jedis jedis = null;</div><div>        try {</div><div>            jedis = jedisPool.getResource();</div><div>            String realKey = prefix.getPrefix()+key;</div><div>            return jedis.exists(realKey);</div><div>        }finally {</div><div>            returnToPool(jedis);</div><div>        }</div><div>    }</div><div><br/></div><div><br/></div><div>    /**</div><div>     *将提供的K加1</div><div>     * @param prefix</div><div>     * @param key</div><div>     * @param &lt;T&gt;</div><div>     * @return</div><div>     */</div><div>    public &lt;T&gt; Long incr(KeyPrefix prefix, String key){</div><div>        Jedis jedis = null;</div><div>        try {</div><div>            jedis = jedisPool.getResource();</div><div>            String realKey = prefix.getPrefix()+key;</div><div>            return jedis.incr(realKey);</div><div>        }finally {</div><div>            returnToPool(jedis);</div><div>        }</div><div>    }</div><div><br/></div><div><br/></div><div>    /**</div><div>     * 将提供的K减1</div><div>     * @param prefix</div><div>     * @param key</div><div>     * @param &lt;T&gt;</div><div>     * @return</div><div>     */</div><div>    public &lt;T&gt; Long decr(KeyPrefix prefix, String key){</div><div>        Jedis jedis = null;</div><div>        try {</div><div>            jedis = jedisPool.getResource();</div><div>            String realKey = prefix.getPrefix()+key;</div><div>            return jedis.decr(realKey);</div><div>        }finally {</div><div>            returnToPool(jedis);</div><div>        }</div><div>    }</div><div><br/></div><div><br/></div><div>    <b><font style="font-size: 11pt;">private &lt;T&gt; String beanToString(T val) {</font></b></div><div><b><font style="font-size: 11pt;">        if(val == null) {</font></b></div><div><b><font style="font-size: 11pt;">            return null;</font></b></div><div><b><font style="font-size: 11pt;">        }</font></b></div><div><b><font style="font-size: 11pt;">        Class&lt;?&gt; clazz = val.getClass();</font></b></div><div><b><font style="font-size: 11pt;">        if(clazz == int.class || clazz == Integer.class) {</font></b></div><div><b><font style="font-size: 11pt;">            return &quot;&quot;+val;</font></b></div><div><b><font style="font-size: 11pt;">        }else if(clazz == String.class) {</font></b></div><div><b><font style="font-size: 11pt;">            return (String)val;</font></b></div><div><b><font style="font-size: 11pt;">        }else if(clazz == long.class || clazz == Long.class) {</font></b></div><div><b><font style="font-size: 11pt;">            return &quot;&quot;+val;</font></b></div><div><b><font style="font-size: 11pt;">        }else {</font></b></div><div><b><font style="font-size: 11pt;">            return JSON.toJSONString(val);</font></b></div><div><b><font style="font-size: 11pt;">        }</font></b></div><div><b><font style="font-size: 11pt;">    }</font></b></div><div><br/></div><div><br/></div><div>    <b><font style="font-size: 11pt;">private &lt;T&gt; T stringToBean(String str, Class&lt;T&gt; clazz) {</font></b></div><div><b><font style="font-size: 11pt;">        if(str == null || str.length() &lt;= 0 || clazz == null) return null;</font></b></div><div><b><font style="font-size: 11pt;">        if (clazz == Integer.class || clazz == int.class)</font></b></div><div><b><font style="font-size: 11pt;">        {</font></b></div><div><b><font style="font-size: 11pt;">            return (T) Integer.valueOf(str);</font></b></div><div><b><font style="font-size: 11pt;">        }</font></b></div><div><b><font style="font-size: 11pt;">        if (clazz == String.class){</font></b></div><div><b><font style="font-size: 11pt;">            return (T)str;</font></b></div><div><b><font style="font-size: 11pt;">        }</font></b></div><div><b><font style="font-size: 11pt;">        if (clazz == Long.class){</font></b></div><div><b><font style="font-size: 11pt;">            return (T)Long.valueOf(str);</font></b></div><div><b><font style="font-size: 11pt;">        }</font></b></div><div><b><font style="font-size: 11pt;">        else {</font></b></div><div><b><font style="font-size: 11pt;">            return JSON.toJavaObject(JSON.parseObject(str), clazz);</font></b></div><div><b><font style="font-size: 11pt;">        }</font></b></div><div><b><font style="font-size: 11pt;">    }</font></b></div><div><br/></div><div><br/></div><div>    private void returnToPool(Jedis jedis) {</div><div>        if(jedis != null) {</div><div>            jedis.close();</div><div>        }</div><div>    }</div><div>}</div></div><div><br/></div><div>5）接口、抽象类、实现类的编写</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>接口</div><div>package com.imooc.miaosha.redis;</div><div><br/></div><div><br/></div><div>public interface KeyPrefix {</div><div><br/></div><div><br/></div><div>    public int empireSecond();</div><div><br/></div><div><br/></div><div>    public String getPrefix();</div><div>}</div><div><br/></div><div>抽象类</div><div>package com.imooc.miaosha.redis;</div><div><br/></div><div><br/></div><div>public abstract class BasePrefix  implements  KeyPrefix{</div><div><br/></div><div><br/></div><div>    int empireSecond;</div><div>    String prefix;</div><div><br/></div><div><br/></div><div>    public BasePrefix(){};</div><div><br/></div><div><br/></div><div>    public BasePrefix(String prefix){</div><div>        this(0, prefix);</div><div>    }</div><div><br/></div><div><br/></div><div>    public BasePrefix(int empireSecond, String prefix){</div><div>        this.empireSecond = empireSecond;</div><div>        this.prefix = prefix;</div><div>    }</div><div><br/></div><div><br/></div><div>    @Override</div><div>    public int empireSecond() {</div><div>        return empireSecond;</div><div>    }</div><div><br/></div><div><br/></div><div>    @Override</div><div>    public String getPrefix() {</div><div>        String name = getClass().getSimpleName();</div><div>        return name+&quot;:&quot;+prefix;</div><div>    }</div><div>}</div><div><br/></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">实现类</span></div><div>package com.imooc.miaosha.redis;</div><div><br/></div><div><br/></div><div>public class UserKey extends BasePrefix{</div><div><br/></div><div><br/></div><div>    public UserKey(String prefix){</div><div>        super(prefix);</div><div>    }</div><div><br/></div><div><br/></div><div>    public static UserKey getById = new UserKey(&quot;id&quot;);</div><div>    public static UserKey getByName = new UserKey(&quot;name&quot;);</div><div>}</div></div><div><br/></div><div>结构：</div><div><img src="第一章 环境搭建_files/Image [1].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div><br/></div></div><div><br/></div></span>
</div></body></html> 